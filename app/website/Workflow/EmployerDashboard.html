<!DOCTYPE html>
<html>
<head>
  <title>Dashboard | Employer</title>
  <script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>

  <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/lib/js/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="/app/lib/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="/style.css" />
</head>

<body>
  <h1 class="jumbotron" onclick="document.location='/'">Данные сотрудника</h1>
  <br>
    <ul>
      <li class="row">
        <label class="col-md-2 font-weight-bold">Имя</label>
        <label class="col-md-2 font-weight-bold">Фамилия</label>
        <label class="col-md-2 font-weight-bold">Отчество</label>
        <label class="col-md-2 font-weight-bold">Звание</label>
      </li>
      <div id="employerList">
      </div>
    </ul>
  <br>
  <div class="row justify-content-md-center">
        <button id="addData" disabled style="max-width: 23.667%;" class="btn btn-info col-md-5" href="AddEmployer.html" type="button">Добавить данные сотрудника</button>
        <button id="upgradeData" style="max-width: 23.667%;" class="btn btn-info col-md-5 offset-md-1" href="UpdateEmployer.html" type="button">Изменить данные сотрудника</button>
  </div>
</ul> 
</br>
<script type="text/javascript">

$('document').ready(function(){
  refreshEmployerdata();
});

function refreshEmployerdata(){

  var adminFlag;
  var employerList = new Array();

  $.post("/AsrtAdmin", function(data){
    if(data != null){
      adminFlag = data;
      if (data == true){
        console.log("YouAdmin");
      }else{
       console.log("YouUser");
      }
    }
  });

  setTimeout(function(){
    if(adminFlag){
      var employerArrSize;
      $.post("/GetEmployerArraySize", function(data){
        console.log(data);
        if(data != null){
          employerArrSize = data;
        }
      })
      console.log(employerArrSize);
      for (var i = 0; i < 4; i++){
        $.post("/GetEmployerFromNum", {empNum:i}, function(data){
          var status, buttonClass, liClass;
          console.log(data);
          employerList[i] = new Array();
          if(data != null){
            employerList[i] = data;
            if(employerList[i][7]){
              status = "Deactivate";
              buttonClass = "btn-danger";
              liClass = "";
            }else {
              status = "Activate";
              buttonClass = "btn-success";
              liClass = "bg-secondary"
            }

            $("#employerList").append('<li class="row">' + liClass + '">' +
                '<div class="col-md-2">' + employerList[i][1] + '</div>' +
                '<a class="col-md-4 font-weight-bold" href="/AddEmployer.html?jobID=' + employerList[i][0] + '">' + employerList[i][2] + '</a>' +
                '<div class="col-md-2">' + employerList[i][1] + '</div>' +
                '<div class="col-md-2">' + employerList[i][2] + '</div>' +
                '<div class="col-md-2">' + employerList[i][5] + '</div>' +
                '</li>' +
                '<br>');
          }
        })
      }
    }else{
      $.post("/GetEmployerFromAddr", function(data){
        if(data != null){
          console.log(data);
          employerList = data;
          $('#addData').attr("disabled","");
          $("#employerList").append('<li class="row">' +
                '<div class="col-md-2">' + employerList[0] + '</div>' +
                '<div class="col-md-2">' + employerList[1] + '</div>' +
                '<div class="col-md-2">' + employerList[2] + '</div>' +
                '<div class="col-md-2">' + employerList[5] + '</div>' +
                '</li>' +
                '<br>');
        }else{
        $('#upgradeData').attr("disabled","");
        }
      });
    }
  }, 400)
}

</script>
</body>
</html>
